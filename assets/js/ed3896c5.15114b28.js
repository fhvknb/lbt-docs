"use strict";(self.webpackChunklbt_docs=self.webpackChunklbt_docs||[]).push([[5864],{3378:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"DevOps/docker/node\u955c\u50cf\u6253\u5305\u4f18\u5316","title":"Node Alpine \u6253\u5305\u4f18\u5316","description":"1. \u591a\u9636\u6bb5\u6784\u5efa","source":"@site/docs/DevOps/docker/node\u955c\u50cf\u6253\u5305\u4f18\u5316.md","sourceDirName":"DevOps/docker","slug":"/DevOps/docker/node\u955c\u50cf\u6253\u5305\u4f18\u5316","permalink":"/docs/DevOps/docker/node\u955c\u50cf\u6253\u5305\u4f18\u5316","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Docker run -e \u547d\u4ee4\u8be6\u89e3","permalink":"/docs/DevOps/docker/docker run(-e)\u8be6\u89e3"},"next":{"title":"Docker\u4e2dVolume\u4f7f\u7528\u8bf4\u660e","permalink":"/docs/DevOps/docker/volume\u4f7f\u7528\u8bf4\u660e"}}');var d=o(4848),s=o(8453);const c={},t="Node Alpine \u6253\u5305\u4f18\u5316",l={},i=[];function a(n){const e={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",pre:"pre",...(0,s.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"node-alpine-\u6253\u5305\u4f18\u5316",children:"Node Alpine \u6253\u5305\u4f18\u5316"})}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsx)(e.li,{children:"\u591a\u9636\u6bb5\u6784\u5efa"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-dockerfile",children:'# \u6784\u5efa\u9636\u6bb5\nFROM node:18-alpine AS builder\n\n# \u5b89\u88c5\u6784\u5efa\u4f9d\u8d56\nRUN apk add --no-cache python3 make g++\n\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY . .\nRUN npm run build\n\n# \u8fd0\u884c\u9636\u6bb5\nFROM node:18-alpine\n\nWORKDIR /app\n# \u53ea\u590d\u5236\u751f\u4ea7\u73af\u5883\u9700\u8981\u7684\u6587\u4ef6\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./\n\n# \u4f7f\u7528\u975e root \u7528\u6237\u8fd0\u884c\nUSER node\n\nCMD ["node", "dist/index.js"]\n\n'})}),"\n",(0,d.jsxs)(e.ol,{start:"2",children:["\n",(0,d.jsx)(e.li,{children:"\u7f13\u5b58\u4f18\u5316"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:18-alpine\n\nWORKDIR /app\n\n# \u5206\u79bb\u4f9d\u8d56\u5b89\u88c5\u548c\u5e94\u7528\u4ee3\u7801\nCOPY package*.json ./\nRUN npm ci --only=production\n\n# \u590d\u5236\u5e94\u7528\u4ee3\u7801\nCOPY . .\n\nCMD ["node", "index.js"]\n\n'})}),"\n",(0,d.jsxs)(e.ol,{start:"3",children:["\n",(0,d.jsx)(e.li,{children:"\u51cf\u5c0f\u955c\u50cf\u4f53\u79ef"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-dockerfile",children:'FROM node:18-alpine\n\nWORKDIR /app\n\n# \u5408\u5e76\u547d\u4ee4\u51cf\u5c11\u5c42\u6570\nCOPY package*.json ./\nRUN npm ci --only=production && \\\n    npm cache clean --force\n\n# \u5220\u9664\u4e0d\u5fc5\u8981\u7684\u6587\u4ef6\nRUN rm -rf /tmp/* && \\\n    rm -rf ~/.npm && \\\n    find /usr/local/lib/node_modules -type f -name "*.md" -delete && \\\n    find /usr/local/lib/node_modules -type f -name "*.ts" -delete\n\nCOPY . .\nCMD ["node", "index.js"]\n\n'})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},8453:(n,e,o)=>{o.d(e,{R:()=>c,x:()=>t});var r=o(6540);const d={},s=r.createContext(d);function c(n){const e=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:c(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);