"use strict";(self.webpackChunklbt_docs=self.webpackChunklbt_docs||[]).push([[8570],{28453:(n,e,d)=>{d.d(e,{R:()=>c,x:()=>i});var r=d(96540);const s={},o=r.createContext(s);function c(n){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),r.createElement(o.Provider,{value:e},n.children)}},77692:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>a,frontMatter:()=>c,metadata:()=>r,toc:()=>p});const r=JSON.parse('{"id":"DevOps/docker/\u955c\u50cf\u6253\u5305\u4f18\u5316node-alpine","title":"\u955c\u50cf\u6253\u5305\u4f18\u5316Node Alpine","description":"1. \u591a\u9636\u6bb5\u6784\u5efa","source":"@site/docs/DevOps/docker/\u955c\u50cf\u6253\u5305\u4f18\u5316node-alpine.md","sourceDirName":"DevOps/docker","slug":"/DevOps/docker/\u955c\u50cf\u6253\u5305\u4f18\u5316node-alpine","permalink":"/docs/DevOps/docker/\u955c\u50cf\u6253\u5305\u4f18\u5316node-alpine","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tag":["docker"]},"sidebar":"tutorialSidebar","previous":{"title":"Docker\u6570\u636e\u5377\u6570\u636e\u7684\u590d\u5236\u548c\u8fc1\u79fb","permalink":"/docs/DevOps/docker/\u6570\u636e\u5377\u4e2d\u6570\u636e\u7684\u590d\u5236\u548c\u8fc1\u79fb"},"next":{"title":"macOS \u78c1\u76d8\u7ba1\u7406\u4e0e\u7cfb\u7edf\u6e05\u7406\u6307\u5357","permalink":"/docs/DevOps/macOS_\u78c1\u76d8\u7ba1\u7406\u4e0e\u7cfb\u7edf\u6e05\u7406\u6307\u5357"}}');var s=d(74848),o=d(28453);const c={tag:["docker"]},i="\u955c\u50cf\u6253\u5305\u4f18\u5316Node Alpine",l={},p=[];function t(n){const e={br:"br",code:"code",em:"em",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u955c\u50cf\u6253\u5305\u4f18\u5316node-alpine",children:"\u955c\u50cf\u6253\u5305\u4f18\u5316Node Alpine"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u591a\u9636\u6bb5\u6784\u5efa"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:"# \u6784\u5efa\u9636\u6bb5\nFROM node:18-alpine AS builder\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h1,{id:"\u5b89\u88c5\u6784\u5efa\u4f9d\u8d56",children:"\u5b89\u88c5\u6784\u5efa\u4f9d\u8d56"}),"\n",(0,s.jsx)(e.p,{children:"RUN apk add --no-cache python3 make g++"}),"\n",(0,s.jsx)(e.p,{children:"WORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production"}),"\n",(0,s.jsx)(e.p,{children:"COPY . .\nRUN npm run build"}),"\n",(0,s.jsx)(e.h1,{id:"\u8fd0\u884c\u9636\u6bb5",children:"\u8fd0\u884c\u9636\u6bb5"}),"\n",(0,s.jsx)(e.p,{children:"FROM node:18-alpine"}),"\n",(0,s.jsx)(e.p,{children:"WORKDIR /app"}),"\n",(0,s.jsx)(e.h1,{id:"\u53ea\u590d\u5236\u751f\u4ea7\u73af\u5883\u9700\u8981\u7684\u6587\u4ef6",children:"\u53ea\u590d\u5236\u751f\u4ea7\u73af\u5883\u9700\u8981\u7684\u6587\u4ef6"}),"\n",(0,s.jsx)(e.p,{children:"COPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./"}),"\n",(0,s.jsx)(e.h1,{id:"\u4f7f\u7528\u975e-root-\u7528\u6237\u8fd0\u884c",children:"\u4f7f\u7528\u975e root \u7528\u6237\u8fd0\u884c"}),"\n",(0,s.jsx)(e.p,{children:"USER node"}),"\n",(0,s.jsx)(e.p,{children:'CMD ["node", "dist/index.js"]'}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'2. \u7f13\u5b58\u4f18\u5316\n```dockerfile\nFROM node:18-alpine\n\nWORKDIR /app\n\n# \u5206\u79bb\u4f9d\u8d56\u5b89\u88c5\u548c\u5e94\u7528\u4ee3\u7801\nCOPY package*.json ./\nRUN npm ci --only=production\n\n# \u590d\u5236\u5e94\u7528\u4ee3\u7801\nCOPY . .\n\nCMD ["node", "index.js"]\n'})}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u51cf\u5c0f\u955c\u50cf\u4f53\u79ef"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:"FROM node:18-alpine\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"WORKDIR /app"}),"\n",(0,s.jsx)(e.h1,{id:"\u5408\u5e76\u547d\u4ee4\u51cf\u5c11\u5c42\u6570",children:"\u5408\u5e76\u547d\u4ee4\u51cf\u5c11\u5c42\u6570"}),"\n",(0,s.jsxs)(e.p,{children:["COPY package*.json ./\nRUN npm ci --only=production && ",(0,s.jsx)(e.br,{}),"\n","npm cache clean --force"]}),"\n",(0,s.jsx)(e.h1,{id:"\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u6587\u4ef6",children:"\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u6587\u4ef6"}),"\n",(0,s.jsxs)(e.p,{children:["RUN rm -rf /tmp/* && ",(0,s.jsx)(e.br,{}),"\n","rm -rf ~/.npm && ",(0,s.jsx)(e.br,{}),"\n",'find /usr/local/lib/node_modules -type f -name "',(0,s.jsxs)(e.em,{children:['.md" -delete && ',(0,s.jsx)(e.br,{}),"\n",'find /usr/local/lib/node_modules -type f -name "']}),'.ts" -delete']}),"\n",(0,s.jsx)(e.p,{children:'COPY . .\nCMD ["node", "index.js"]'}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{})})]})}function a(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(t,{...n})}):t(n)}}}]);