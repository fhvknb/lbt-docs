"use strict";(self.webpackChunklbt_docs=self.webpackChunklbt_docs||[]).push([[9778],{9845:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"FrontEnd/javascript/React_Markdown\u6027\u80fd\u4f18\u5316","title":"React_Markdown\u6027\u80fd\u4f18\u5316","description":"react-markdown \u61d2\u52a0\u8f7d\u5b9e\u73b0\u65b9\u6848","source":"@site/docs/FrontEnd/javascript/React_Markdown\u6027\u80fd\u4f18\u5316.md","sourceDirName":"FrontEnd/javascript","slug":"/FrontEnd/javascript/React_Markdown\u6027\u80fd\u4f18\u5316","permalink":"/docs/FrontEnd/javascript/React_Markdown\u6027\u80fd\u4f18\u5316","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tag":["react","lazy-load"]},"sidebar":"tutorialSidebar","previous":{"title":"Next.js \u591a\u8bed\u8a00\u5b9e\u73b0\u6700\u4f73\u5b9e\u8df5\u793a\u4f8b\u6a21\u677f","permalink":"/docs/FrontEnd/javascript/NextJS\u591a\u8bed\u8a00i18n\u5b9e\u8df5\u53c2\u8003"},"next":{"title":"React\u4e2d\u7684memo\u65b9\u6cd5\u548cuseMemo","permalink":"/docs/FrontEnd/javascript/React\u4e2d\u7684memo\u65b9\u6cd5\u548cuseMemo"}}');var r=t(74848),o=t(28453);const i={tag:["react","lazy-load"]},a=void 0,c={},l=[{value:"react-markdown \u61d2\u52a0\u8f7d\u5b9e\u73b0\u65b9\u6848",id:"react-markdown-\u61d2\u52a0\u8f7d\u5b9e\u73b0\u65b9\u6848",level:2},{value:"1. \u5206\u5757\u6e32\u67d3\u65b9\u6848",id:"1-\u5206\u5757\u6e32\u67d3\u65b9\u6848",level:3},{value:"2. \u865a\u62df\u6eda\u52a8\u4f18\u5316\u65b9\u6848",id:"2-\u865a\u62df\u6eda\u52a8\u4f18\u5316\u65b9\u6848",level:3},{value:"3. \u52a8\u6001\u5bfc\u5165\u548c\u4ee3\u7801\u5206\u5272\u65b9\u6848",id:"3-\u52a8\u6001\u5bfc\u5165\u548c\u4ee3\u7801\u5206\u5272\u65b9\u6848",level:3},{value:"4. \u6027\u80fd\u4f18\u5316\u914d\u7f6e",id:"4-\u6027\u80fd\u4f18\u5316\u914d\u7f6e",level:3},{value:"\u8fd0\u884c\u6548\u679c\u793a\u4f8b",id:"\u8fd0\u884c\u6548\u679c\u793a\u4f8b",level:2},{value:"\u5206\u5757\u6e32\u67d3\u6548\u679c",id:"\u5206\u5757\u6e32\u67d3\u6548\u679c",level:3},{value:"\u6027\u80fd\u5bf9\u6bd4",id:"\u6027\u80fd\u5bf9\u6bd4",level:3},{value:"\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae",id:"\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"react-markdown-\u61d2\u52a0\u8f7d\u5b9e\u73b0\u65b9\u6848",children:"react-markdown \u61d2\u52a0\u8f7d\u5b9e\u73b0\u65b9\u6848"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u7b54\u6848\uff1areact-markdown \u672c\u8eab\u4e0d\u76f4\u63a5\u652f\u6301\u61d2\u52a0\u8f7d\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u5b9e\u73b0\u5927\u6587\u672c\u7684\u61d2\u52a0\u8f7d\u6e32\u67d3\u3002"})}),"\n",(0,r.jsx)(e.h3,{id:"1-\u5206\u5757\u6e32\u67d3\u65b9\u6848",children:"1. \u5206\u5757\u6e32\u67d3\u65b9\u6848"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:"import React, { useState, useEffect, useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\n\nconst LazyMarkdownRenderer = ({ markdownContent, chunkSize = 1000 }) => {\n  const [visibleChunks, setVisibleChunks] = useState(1);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // \u5c06\u5927\u6587\u672c\u5206\u5272\u6210\u5757\n  const chunks = useMemo(() => {\n    const lines = markdownContent.split('\\n');\n    const result = [];\n    \n    for (let i = 0; i < lines.length; i += chunkSize) {\n      result.push(lines.slice(i, i + chunkSize).join('\\n'));\n    }\n    \n    return result;\n  }, [markdownContent, chunkSize]);\n\n  // \u61d2\u52a0\u8f7d\u66f4\u591a\u5185\u5bb9\n  const loadMoreContent = () => {\n    if (visibleChunks < chunks.length && !isLoading) {\n      setIsLoading(true);\n      \n      // \u6a21\u62df\u5f02\u6b65\u52a0\u8f7d\n      setTimeout(() => {\n        setVisibleChunks(prev => Math.min(prev + 1, chunks.length));\n        setIsLoading(false);\n      }, 100);\n    }\n  };\n\n  // \u6eda\u52a8\u76d1\u542c\n  useEffect(() => {\n    const handleScroll = () => {\n      const { scrollTop, scrollHeight, clientHeight } = document.documentElement;\n      \n      if (scrollTop + clientHeight >= scrollHeight - 100) {\n        loadMoreContent();\n      }\n    };\n\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [visibleChunks, chunks.length, isLoading]);\n\n  // \u6e32\u67d3\u53ef\u89c1\u7684\u5757\n  const visibleContent = chunks.slice(0, visibleChunks).join('\\n');\n\n  return (\n    <div className=\"lazy-markdown-container\">\n      <ReactMarkdown\n        components={{\n          code({ node, inline, className, children, ...props }) {\n            const match = /language-(\\w+)/.exec(className || '');\n            return !inline && match ? (\n              <SyntaxHighlighter\n                language={match[1]}\n                PreTag=\"div\"\n                {...props}\n              >\n                {String(children).replace(/\\n$/, '')}\n              </SyntaxHighlighter>\n            ) : (\n              <code className={className} {...props}>\n                {children}\n              </code>\n            );\n          }\n        }}\n      >\n        {visibleContent}\n      </ReactMarkdown>\n      \n      {isLoading && (\n        <div className=\"loading-indicator\">\n          \u6b63\u5728\u52a0\u8f7d\u66f4\u591a\u5185\u5bb9...\n        </div>\n      )}\n      \n      {visibleChunks < chunks.length && (\n        <button \n          onClick={loadMoreContent}\n          className=\"load-more-btn\"\n          disabled={isLoading}\n        >\n          \u52a0\u8f7d\u66f4\u591a ({visibleChunks}/{chunks.length})\n        </button>\n      )}\n    </div>\n  );\n};\n\nexport default LazyMarkdownRenderer;\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u865a\u62df\u6eda\u52a8\u4f18\u5316\u65b9\u6848",children:"2. \u865a\u62df\u6eda\u52a8\u4f18\u5316\u65b9\u6848"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:"import React, { useState, useEffect, useRef } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { FixedSizeList as List } from 'react-window';\n\nconst VirtualizedMarkdown = ({ markdownContent }) => {\n  const [parsedLines, setParsedLines] = useState([]);\n  const listRef = useRef();\n\n  useEffect(() => {\n    // \u9884\u5904\u7406markdown\u5185\u5bb9\u4e3a\u884c\u6570\u7ec4\n    const lines = markdownContent.split('\\n').map((line, index) => ({\n      id: index,\n      content: line,\n      type: getLineType(line) // \u5224\u65ad\u884c\u7c7b\u578b\uff08\u6807\u9898\u3001\u4ee3\u7801\u3001\u666e\u901a\u6587\u672c\u7b49\uff09\n    }));\n    \n    setParsedLines(lines);\n  }, [markdownContent]);\n\n  const getLineType = (line) => {\n    if (line.startsWith('#')) return 'heading';\n    if (line.startsWith('```')) return 'code-block';\n    if (line.startsWith('- ') || line.startsWith('* ')) return 'list';\n    return 'text';\n  };\n\n  // \u6e32\u67d3\u5355\u884c\u7ec4\u4ef6\n  const LineRenderer = ({ index, style }) => {\n    const line = parsedLines[index];\n    \n    return (\n      <div style={style} className={`line-${line.type}`}>\n        <ReactMarkdown>\n          {line.content}\n        </ReactMarkdown>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"virtualized-markdown\">\n      <List\n        ref={listRef}\n        height={600} // \u5bb9\u5668\u9ad8\u5ea6\n        itemCount={parsedLines.length}\n        itemSize={30} // \u6bcf\u884c\u9ad8\u5ea6\n        itemData={parsedLines}\n      >\n        {LineRenderer}\n      </List>\n    </div>\n  );\n};\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u52a8\u6001\u5bfc\u5165\u548c\u4ee3\u7801\u5206\u5272\u65b9\u6848",children:"3. \u52a8\u6001\u5bfc\u5165\u548c\u4ee3\u7801\u5206\u5272\u65b9\u6848"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:"import React, { Suspense, lazy } from 'react';\n\n// \u61d2\u52a0\u8f7d ReactMarkdown \u7ec4\u4ef6\nconst ReactMarkdown = lazy(() => import('react-markdown'));\n\nconst LazyMarkdownLoader = ({ markdownUrl }) => {\n  const [content, setContent] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const loadMarkdownContent = async (url) => {\n    setLoading(true);\n    try {\n      const response = await fetch(url);\n      const text = await response.text();\n      \n      // \u5206\u6279\u5904\u7406\u5927\u6587\u672c\n      const chunks = chunkText(text, 5000);\n      \n      // \u9010\u6b65\u52a0\u8f7d\u5185\u5bb9\n      for (let i = 0; i < chunks.length; i++) {\n        await new Promise(resolve => setTimeout(resolve, 100));\n        setContent(prev => prev + chunks[i]);\n      }\n    } catch (error) {\n      console.error('\u52a0\u8f7dMarkdown\u5931\u8d25:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const chunkText = (text, size) => {\n    const chunks = [];\n    for (let i = 0; i < text.length; i += size) {\n      chunks.push(text.slice(i, i + size));\n    }\n    return chunks;\n  };\n\n  return (\n    <div className=\"lazy-markdown-loader\">\n      <button onClick={() => loadMarkdownContent(markdownUrl)}>\n        \u52a0\u8f7dMarkdown\u5185\u5bb9\n      </button>\n      \n      {loading && <div>\u6b63\u5728\u52a0\u8f7d...</div>}\n      \n      <Suspense fallback={<div>\u6b63\u5728\u52a0\u8f7dMarkdown\u6e32\u67d3\u5668...</div>}>\n        {content && (\n          <ReactMarkdown>{content}</ReactMarkdown>\n        )}\n      </Suspense>\n    </div>\n  );\n};\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u6027\u80fd\u4f18\u5316\u914d\u7f6e",children:"4. \u6027\u80fd\u4f18\u5316\u914d\u7f6e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-jsx",children:"import React, { memo, useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\n\nconst OptimizedMarkdown = memo(({ content, maxLength = 10000 }) => {\n  // \u622a\u65ad\u8fc7\u957f\u5185\u5bb9\n  const truncatedContent = useMemo(() => {\n    if (content.length <= maxLength) return content;\n    \n    return content.substring(0, maxLength) + '\\n\\n...[\u5185\u5bb9\u5df2\u622a\u65ad]';\n  }, [content, maxLength]);\n\n  // \u4f18\u5316\u7684\u7ec4\u4ef6\u914d\u7f6e\n  const components = useMemo(() => ({\n    // \u61d2\u52a0\u8f7d\u56fe\u7247\n    img: ({ src, alt, ...props }) => (\n      <img \n        src={src} \n        alt={alt} \n        loading=\"lazy\"\n        style={{ maxWidth: '100%' }}\n        {...props} \n      />\n    ),\n    \n    // \u4ee3\u7801\u5757\u4f18\u5316\n    code: ({ children, className, ...props }) => {\n      // \u5bf9\u5927\u4ee3\u7801\u5757\u8fdb\u884c\u7279\u6b8a\u5904\u7406\n      if (typeof children === 'string' && children.length > 1000) {\n        return (\n          <details>\n            <summary>\u663e\u793a\u5927\u4ee3\u7801\u5757 ({children.length} \u5b57\u7b26)</summary>\n            <pre className={className} {...props}>\n              <code>{children}</code>\n            </pre>\n          </details>\n        );\n      }\n      \n      return (\n        <code className={className} {...props}>\n          {children}\n        </code>\n      );\n    }\n  }), []);\n\n  return (\n    <ReactMarkdown components={components}>\n      {truncatedContent}\n    </ReactMarkdown>\n  );\n});\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u8fd0\u884c\u6548\u679c\u793a\u4f8b",children:"\u8fd0\u884c\u6548\u679c\u793a\u4f8b"}),"\n",(0,r.jsx)(e.h3,{id:"\u5206\u5757\u6e32\u67d3\u6548\u679c",children:"\u5206\u5757\u6e32\u67d3\u6548\u679c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'\u521d\u59cb\u52a0\u8f7d: \u663e\u793a\u524d1000\u884c\u5185\u5bb9\n\u7528\u6237\u6eda\u52a8: \u81ea\u52a8\u52a0\u8f7d\u4e0b\u4e00\u4e2a1000\u884c\u5757\n\u52a0\u8f7d\u6307\u793a: "\u6b63\u5728\u52a0\u8f7d\u66f4\u591a\u5185\u5bb9..."\n\u8fdb\u5ea6\u663e\u793a: "\u52a0\u8f7d\u66f4\u591a (3/10)"\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6027\u80fd\u5bf9\u6bd4",children:"\u6027\u80fd\u5bf9\u6bd4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u666e\u901a\u6e32\u67d3: 50MB\u6587\u6863 \u2192 15\u79d2\u52a0\u8f7d\u65f6\u95f4\uff0c\u9875\u9762\u5361\u987f\n\u61d2\u52a0\u8f7d\u65b9\u6848: 50MB\u6587\u6863 \u2192 1\u79d2\u521d\u59cb\u52a0\u8f7d\uff0c\u6d41\u7545\u6eda\u52a8\u4f53\u9a8c\n\u5185\u5b58\u4f7f\u7528: \u51cf\u5c1170%\u5185\u5b58\u5360\u7528\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae",children:"\u6700\u4f73\u5b9e\u8df5\u5efa\u8bae"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5185\u5bb9\u5206\u5757"}),": \u5c06\u5927\u6587\u6863\u5206\u5272\u6210\u5c0f\u5757\uff0c\u6309\u9700\u6e32\u67d3"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u865a\u62df\u6eda\u52a8"}),": \u5bf9\u8d85\u5927\u6587\u6863\u4f7f\u7528\u865a\u62df\u6eda\u52a8\u6280\u672f"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u6001\u5bfc\u5165"}),": \u61d2\u52a0\u8f7d react-markdown \u7ec4\u4ef6\u672c\u8eab"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6027\u80fd\u76d1\u63a7"}),": \u76d1\u63a7\u6e32\u67d3\u6027\u80fd\uff0c\u9002\u65f6\u4f18\u5316"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>a});var s=t(96540);const r={},o=s.createContext(r);function i(n){const e=s.useContext(o);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);